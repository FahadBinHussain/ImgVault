<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ImgVault v2.0 - File Upload Fix</title>
  <link rel="icon" type="image/png" href="icons/icon48.png">
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <!-- No Image State -->
  <div id="noImageView" class="view">
    <div class="header">
      <img src="icons/icon48.png" alt="ImgVault" class="logo">
      <div class="header-content">
        <h2>ImgVault</h2>
        <p>Your personal image vault</p>
      </div>
      <button id="galleryBtn" class="icon-btn" title="View Gallery">ğŸ–¼ï¸</button>
      <button id="settingsBtn" class="icon-btn" title="Settings">âš™ï¸</button>
    </div>
    
    <div class="empty-state">
      <div class="empty-icon">ğŸ–¼ï¸</div>
      <h3>No Image Selected</h3>
      <p>Right-click any image on a webpage and select "Save to ImgVault" to get started</p>
      <p style="margin-top: 20px; color: var(--text-muted);">â€” or â€”</p>
      <button id="uploadFromPCBtn" class="btn btn-primary" style="margin-top: 10px;">
        ğŸ“¤ Upload from Computer
      </button>
      <input type="file" id="uploadFileInput" accept="image/*" style="display: none;">
    </div>
  </div>

  <!-- Image Upload View -->
  <div id="imageView" class="view" style="display: none;">
    <div class="header">
      <img src="icons/icon48.png" alt="ImgVault" class="logo">
      <div class="header-content">
        <h2>Save to Vault</h2>
        <p>Preserve with context</p>
      </div>
      <button id="settingsBtn" class="icon-btn" title="Settings">âš™ï¸</button>
    </div>
    
    <!-- Google Drive Tip Banner -->
    <div id="gdriveTip" class="tip-banner" style="display: none;">
      <span class="tip-icon">ğŸ’¡</span>
      <span class="tip-text">For maximum quality from Google Drive, download the file first then use "Upload Better Quality" button</span>
      <button id="closeTip" class="tip-close">âœ•</button>
    </div>
    
    <!-- Image Replaced Banner -->
    <div id="replacedBanner" class="replaced-banner" style="display: none;">
      <span class="banner-icon">âœ…</span>
      <span class="banner-text">Image replaced! Ready to upload higher quality version</span>
      <button id="closeReplaced" class="banner-close">âœ•</button>
    </div>
    
    <div class="image-preview">
      <img id="previewImage" alt="Preview">
      <div class="image-controls">
        <button id="replaceImageBtn" class="replace-btn" title="Upload from PC" type="button">
          <span class="icon">ğŸ“</span>
          <span class="text">Upload Better Quality</span>
        </button>
        <input type="file" id="fileInput" accept="image/*" style="display: none;">
      </div>
    </div>
    
    <div class="form-section">
      <div class="form-group">
        <label>ğŸ“ File Name</label>
        <div class="url-display" id="sourceUrlDisplay"></div>
      </div>
      
      <div class="form-group">
        <label>ğŸŒ Page URL</label>
        <div class="input-group">
          <input type="text" id="pageUrlInput" readonly placeholder="https://...">
          <button id="editPageUrlBtn" class="icon-btn" title="Edit">âœï¸</button>
        </div>
      </div>
      
      <div class="form-group">
        <label>ğŸ“ Notes (Optional)</label>
        <textarea id="notesInput" placeholder="Add your notes about this image..."></textarea>
      </div>
      
      <div class="form-group">
        <label>ğŸ·ï¸ Tags (Optional)</label>
        <input type="text" id="tagsInput" placeholder="design, inspiration, reference">
      </div>
      
      <div id="statusMessage" class="status" style="display: none;"></div>
      
      <!-- Upload Progress Indicator -->
      <div id="uploadProgress" class="upload-progress" style="display: none;">
        <div class="progress-spinner"></div>
        <div id="progressText" class="progress-text"></div>
      </div>
      
      <!-- Upload Services Indicator -->
      <div id="uploadServicesIndicator" class="upload-services-indicator">
        <span class="services-label">Uploading to:</span>
        <span id="servicesStatus" class="services-status"></span>
      </div>
      
      <button id="uploadBtn" class="btn btn-primary">
        ğŸš€ Upload to ImgVault
      </button>
    </div>
  </div>

  <!-- Success View -->
  <div id="successView" class="view" style="display: none;">
    <div class="header">
      <img src="icons/icon48.png" alt="ImgVault" class="logo">
      <div class="header-content">
        <h2>ImgVault</h2>
        <p>Successfully saved</p>
      </div>
      <button id="settingsBtn" class="icon-btn" title="Settings">âš™ï¸</button>
    </div>
    
    <div class="success-state">
      <div class="success-icon">âœ“</div>
      <h3>Image Saved!</h3>
      <p>Your image has been securely stored in your vault with full context metadata</p>
      
      <div class="stored-url">
        <strong>Pixvid (Compressed):</strong><br>
        <a id="pixvidUrlLink" href="#" target="_blank"></a>
        <button id="copyPixvidBtn" class="btn btn-secondary btn-sm">ğŸ“‹</button>
      </div>
      
      <div class="stored-url" id="imgbbUrlSection" style="display: none;">
        <strong>ImgBB (Original):</strong><br>
        <a id="imgbbUrlLink" href="#" target="_blank"></a>
        <button id="copyImgbbBtn" class="btn btn-secondary btn-sm">ğŸ“‹</button>
      </div>
    </div>
  </div>

  <!-- Settings View -->
  <div id="settingsView" class="view" style="display: none;">
    <div class="header">
      <button id="backToImageBtn" class="icon-btn">â†</button>
      <div class="header-content">
        <h2>Settings</h2>
        <p>Configure your vault</p>
      </div>
    </div>
    
    <div class="form-section">
      <div class="settings-section">
        <h3>ğŸ–¼ï¸ Pixvid API</h3>
        <p class="help-text">Pixvid hosts your images permanently. Get your API key from <a href="https://pixvid.org/settings/api" target="_blank">pixvid.org/settings/api</a></p>
        
        <div class="form-group">
          <label>API Key</label>
          <input type="password" id="apiKeyInput" placeholder="Enter your Pixvid API key">
        </div>
      </div>

      <div class="settings-section">
        <h3>ğŸ”¥ Firebase Configuration</h3>
        <p class="help-text">Firebase Firestore stores your image metadata securely in the cloud. Get your config from the <a href="https://console.firebase.google.com" target="_blank">Firebase Console</a></p>
        
        <div class="form-group">
          <label>Paste Firebase Config</label>
          <textarea id="firebaseConfigPaste" rows="10" placeholder='const firebaseConfig = {
  apiKey: "AIza...",
  authDomain: "your-app.firebaseapp.com",
  projectId: "your-project",
  storageBucket: "your-app.appspot.com",
  messagingSenderId: "123456789",
  appId: "1:123456789:web:abc123"
};'></textarea>
          <small>Paste your entire Firebase config object from Firebase Console â†’ Project Settings</small>
        </div>
      </div>
      
      <button id="saveSettingsBtn" class="btn btn-primary">
        ğŸ’¾ Save Configuration
      </button>
    </div>
  </div>

  <!-- Load scripts -->
  <script src="storage.js"></script>
  <script src="url-normalizer.js"></script>
  <script src="duplicate-detector.js"></script>
  <script src="popup.js"></script>
</body>
</html>
